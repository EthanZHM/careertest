<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>职业倾向测试问卷</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        @media (max-width: 860px) {
            .container {
                padding: 20px 15px;
                margin: 0 10px;
            }
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px 10px;
                margin: 0;
            }
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            position: relative;
        }
        h1:after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background-color: #4CAF50;
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        h4 {
            color: #2c3e50;
            border-left: 4px solid #4CAF50;
            padding-left: 10px;
            margin-top: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .type-section {
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }
        .type-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            background-color: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .option-group {
            display: flex;
            gap: 20px;
        }
        label {
            display: inline-flex;
            align-items: center;
            margin-right: 15px;
        }
        input[type="radio"] {
            margin-right: 5px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .progress {
            width: 0%;
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }
        .section-instruction {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-left: 4px solid #4CAF50;
            color: #2c3e50;
            font-size: 16px;
            line-height: 1.6;
        }
        .section-nav {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        .section-nav button {
            margin: 0 5px;
        }
        .chart-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .assessment-table {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        .assessment-table h3 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .assessment-table table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }
        .assessment-table th, .assessment-table td {
            text-align: center;
            padding: 8px;
            border: 1px solid #ddd;
        }
        .assessment-table th {
            background-color: #4CAF50;
            color: white;
        }
        .assessment-table td:first-child {
            font-weight: bold;
            background-color: #f0f0f0;
        }
        .assessment-table td:hover {
            background-color: #e9f7ef;
        }
        .assessment-table input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .assessment-table input[type="radio"]:checked + .radio-custom {
            background-color: #4CAF50;
        }
        .assessment-table .rating-help {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
            background-color: #fff;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #4CAF50;
        }
        .rating-scale {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 5px;
            background-color: #fff;
            border-radius: 4px;
        }
        .rating-scale div {
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        @media (max-width: 768px) {
            .assessment-table {
                padding: 10px;
            }
            .assessment-table th, .assessment-table td {
                padding: 6px 4px;
                font-size: 14px;
            }
            .assessment-table input[type="radio"] {
                width: 16px;
                height: 16px;
            }
        }
        @media (max-width: 480px) {
            .assessment-table th, .assessment-table td {
                padding: 4px 2px;
                font-size: 12px;
            }
            .assessment-table input[type="radio"] {
                width: 14px;
                height: 14px;
            }
        }
        .category-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .category-label {
            font-size: 14px;
            padding: 5px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .results-table th {
            background-color: #4CAF50;
            color: white;
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .results-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .results-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .results-table td:last-child {
            font-weight: bold;
            background-color: #e9f7ef;
        }
        .highlight-row {
            background-color: #e9f7ef !important;
            font-weight: bold;
        }
        .highlight-row td {
            border-color: #4CAF50;
        }
        .holland-code {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .holland-code p {
            margin-bottom: 10px;
        }
        .holland-code strong {
            color: #4CAF50;
            font-size: 1.2em;
        }
        .career-recommendations {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .career-recommendations ul {
            columns: 2;
            column-gap: 20px;
        }
        .career-recommendations li {
            margin-bottom: 8px;
            break-inside: avoid;
        }
        @media (max-width: 600px) {
            .career-recommendations ul {
                columns: 1;
            }
        }
        @media print {
            body, .container {
                padding: 0;
                margin: 0;
                background: white;
            }
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            .section-nav, button {
                display: none !important;
            }
            h1, h2, h3, h4 {
                page-break-after: avoid;
            }
            p, ul, table {
                page-break-inside: avoid;
            }
        }
        .animation-fade {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* 保存对话框样式 */
        .save-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }
        .save-dialog-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .save-dialog h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .save-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }
        .save-options button {
            min-width: 180px;
            padding: 15px;
            font-size: 16px;
            background-color: #4CAF50;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .save-options button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .close-button {
            background-color: #f8f9fa !important;
            color: #666 !important;
            border: 1px solid #ddd !important;
            margin-top: 15px;
        }
        .close-button:hover {
            background-color: #e9e9e9 !important;
        }
        @media (max-width: 600px) {
            .save-options {
                flex-direction: column;
            }
            .save-dialog-content {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>职业倾向测试问卷</h1>
        
        <div class="progress-bar">
            <div class="progress"></div>
        </div>

        <div class="section" id="instructions">
            <h2>测试说明</h2>
            <p>欢迎参加职业倾向测试问卷。本测验基于荷兰职业心理学家John Holland的RIASEC理论，旨在帮助您探索适合的职业方向。</p>
            <p>本测验将通过四个部分来全面评估您的职业兴趣和能力：</p>
            <ol>
                <li><strong>活动偏好</strong> - 评估您对不同活动的喜好程度</li>
                <li><strong>能力自评</strong> - 评估您在不同领域的能力</li>
                <li><strong>职业兴趣</strong> - 了解您对不同职业的兴趣程度</li>
                <li><strong>自我测评</strong> - 对特定能力进行更详细的评估</li>
            </ol>
            <p>完成全部问卷后，系统将生成您的RIASEC职业代码，并提供适合您的职业推荐。</p>
            <p class="section-instruction">测试时间约为10-15分钟，请根据您的真实情况作答，没有对错之分。</p>
            <div style="text-align: center;">
                <button onclick="startTest()">开始测试</button>
            </div>
        </div>

        <form id="testForm" style="display: none;">
            <!-- 测试内容将通过JavaScript动态加载 -->
        </form>

        <div id="results" style="display: none;">
            <h2>测试结果</h2>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        // 添加全局动画样式
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // 测试数据
        const testData = {
            activities: {
                R: [
                    "修理或组装电子产品",
                    "修理自行车",
                    "修理或组装机械产品",
                    "用木头做东西",
                    "参加技术教育或手工制作课程",
                    "参加机械制图课程",
                    "参加木工技术课程",
                    "参加自动化机械课程",
                    "与杰出的机械师或者技术人员一起工作",
                    "在室外工作",
                    "操作自动化机器或者设备"
                ],
                I: [
                    "阅读科学书籍和杂志",
                    "在研究室或实验室工作",
                    "从事一项科学项目",
                    "研究一个科学理论",
                    "从事与化工品有关的工作",
                    "应用数学解决实际问题",
                    "上物理课",
                    "上化学课",
                    "上数学课",
                    "上生物课",
                    "研究学术或者技术问题"
                ],
                A: [
                    "素描 / 制图 / 绘画",
                    "设计家具，服装或者海报",
                    "在乐队/管弦乐队/其他组团中演奏",
                    "练习乐器",
                    "创造肖像或者拍照",
                    "写小说或者戏剧",
                    "上艺术课",
                    "编曲或者谱曲（不限曲种）",
                    "与有天赋的艺术家、作家或者雕塑家一起工作",
                    "为他人表演（跳舞、唱歌、小品等）",
                    "阅读艺术、文学或者音乐类文章"
                ],
                S: [
                    "会见重要的教育家或者咨询师",
                    "阅读社会学文章和书籍",
                    "为慈善团体工作",
                    "帮助他人解决他们的个人问题",
                    "研究青少年的犯罪问题",
                    "阅读心理学文章或者书籍",
                    "上人类关系课程",
                    "在高中教书",
                    "照看有精神疾病的病人的活动",
                    "给成年人讲课",
                    "从事志愿者的工作"
                ],
                E: [
                    "学习商业成功的策略",
                    "创业",
                    "参加销售会议",
                    "参加行政管理或领导力的短期课程",
                    "担任任何组织的负责人",
                    "监督管理其他人的工作",
                    "会晤重要的执行长官或者领导",
                    "领导一个团队实现某个目标",
                    "参加政治竞选",
                    "担任某一组织或者企业的顾问",
                    "阅读商业杂志或文章"
                ],
                C: [
                    "填写收入报税表",
                    "在交易或记账时进行加、减、乘、除的计算",
                    "使用办公设备",
                    "坚持做详细的开支记录",
                    "建立记录系统（如记录钱，人员，原材料等）",
                    "上会计课",
                    "上商业数学课",
                    "建立生活用品或商品的清单",
                    "检查文案或者产品中的错误或瑕疵",
                    "更新记录或文档",
                    "在办公室内工作"
                ]
            },
            abilities: {
                R: [
                    "我能使用电锯、车床或磨砂机等木工工具",
                    "我能画有比例要求的图纸",
                    "我能给汽车加油或者换轮胎",
                    "我能使用电钻、磨床或缝纫机等电动工具",
                    "我能给家具或木制品刷漆",
                    "我能修理简单的电器用品",
                    "我能修理家具",
                    "我能使用很多手工工具",
                    "我能简单地修理水管",
                    "我能制造简单的木工作品",
                    "我能粉刷房间"
                ],
                I: [
                    "我能使用代数解决数学问题",
                    "我能执行一项科学实验或者调查",
                    "我明白放射性元素的半衰期",
                    "我能使用对数表",
                    "我能使用计算机研究一个科学问题",
                    "我能描述白细胞的功能",
                    "我能解释简单的化学方程式",
                    "我明白为什么人造卫星不会坠落到地球上",
                    "我能写一篇科学报告",
                    "我明白宇宙大爆炸理论",
                    "我明白DNA在遗传中的作用"
                ],
                A: [
                    "我能演奏乐器",
                    "我能参加二部或四部合唱",
                    "我能独唱",
                    "我能演戏",
                    "我能朗诵",
                    "我能画画（油画或水彩）或雕塑",
                    "我能创作或者编曲",
                    "我能设计衣服、海报或者家具",
                    "我会写很不错的故事或诗",
                    "我能写一篇演讲稿",
                    "我能拍摄很吸引人的照片"
                ],
                S: [
                    "我发现与不同类型的人交谈很容易",
                    "我擅长向其他人解释或说明一些事情",
                    "我能做一个有亲和力的组织者",
                    "人们常向我诉说他们的困扰",
                    "我能很轻松地教小孩子",
                    "我能很轻松地教成年人",
                    "我擅长帮助感到不安或者困扰的人们",
                    "我对社会关系有很好的理解",
                    "我擅长教别人",
                    "我擅长使别人感到轻松",
                    "相比物和观念，我更擅长与人打交道"
                ],
                E: [
                    "我知道如何成为一个成功的领导",
                    "我是一个优秀的公共演说者",
                    "我能组织某个销售活动",
                    "我能组织其他人的工作",
                    "我是一个有抱负而且意志坚定的人",
                    "我擅长让别人按照我的方式做事",
                    "我有很好的推销能力",
                    "我有很强的辩论能力",
                    "我非常有说服力",
                    "我有很不错的规划技能",
                    "我具有某些领导力"
                ],
                C: [
                    "我能将函件或其他文件分门别类管理",
                    "我能从事办公室工作",
                    "我能使用自动化的办公设备（如打印机、复印机、计算机等）",
                    "我能很快地完成大量的文案工作",
                    "我能使用简单的数据处理设备",
                    "我能进行收支记录",
                    "我能准确地记录付款和销售额",
                    "我能使用计算机输入信息",
                    "我能撰写商业信函",
                    "我能完成一些常规的办公室工作",
                    "我是一个细心而且有条理的人"
                ]
            },
            careers: {
                R: [
                    "飞机机械师",
                    "汽车机械师",
                    "木工技师",
                    "汽车司机",
                    "测量工程师",
                    "建筑工地现场监理员",
                    "无线电机械师",
                    "交通机车（如火车）工程师",
                    "机械技术员",
                    "电器技术员",
                    "农业技术员",
                    "飞机驾驶员",
                    "电子技术员",
                    "焊接技术员"
                ],
                I: [
                    "气象学科研人员",
                    "生物学科研人员",
                    "天文学科研人员",
                    "医学科研人员",
                    "人类学科研人员",
                    "化学科研人员",
                    "独立的研究科学家",
                    "科学书籍的作家",
                    "地质学科研人员",
                    "植物学科研人员",
                    "科研技术员",
                    "物理学科研人员",
                    "社会科学研究人员",
                    "环境分析学者"
                ],
                A: [
                    "诗人",
                    "音乐家",
                    "小说家",
                    "演员",
                    "自由职业作家",
                    "编曲家",
                    "新闻记者",
                    "艺术家",
                    "歌唱家",
                    "作曲家",
                    "雕刻家",
                    "剧作家",
                    "漫画家",
                    "娱乐节目的艺人"
                ],
                S: [
                    "职业咨询师",
                    "社会学者",
                    "高中教师",
                    "物质依赖治疗师",
                    "青少年犯罪专家",
                    "语言治疗师",
                    "婚姻咨询师",
                    "临床心理学家",
                    "人文社会课教师",
                    "私人咨询师",
                    "青少年野营主管",
                    "社会工作者",
                    "残障人康复咨询师",
                    "儿童乐园主管"
                ],
                E: [
                    "采购员",
                    "广告宣传主管",
                    "工厂管理者",
                    "商业贸易主管",
                    "晚会或仪式主持人",
                    "销售人员",
                    "房地产销售员",
                    "百货商场经理",
                    "销售经理",
                    "公共关系主管",
                    "电视台经理",
                    "小企业主",
                    "法官",
                    "机场经理"
                ],
                C: [
                    "账目记录员",
                    "预算规划员",
                    "注册会计师",
                    "金融信用调查员",
                    "银行出纳员",
                    "税务专家",
                    "物品管理员",
                    "计算机操作员",
                    "金融分析员",
                    "成本估算员",
                    "工资结算员",
                    "银行督察员",
                    "会计职员",
                    "审计职员"
                ]
            }
        };

        let currentSection = 0;
        const sections = ['activities', 'abilities', 'careers', 'selfAssessment'];
        const sectionTitles = {
            activities: '第一部分：活动',
            abilities: '第二部分：能力',
            careers: '第三部分：职业',
            selfAssessment: '第四部分：自我测评'
        };

        const sectionInstructions = {
            activities: '下面列举了各种活动，请就这些活动判断你的偏好。L代表"喜欢"，D代表"不喜欢"或者"无所谓"。请在相应的选项上打勾。',
            abilities: 'Y代表你完全能做或者能做的很好的活动，N代表从来没做过，或者做的很差的活动。请在相应的选项上打勾。',
            careers: '这是你关于很多工作态度和情感的清单。如果某个职业你很感兴趣或者很受吸引，则在相应的Y下面打勾；如果你不喜欢或者没兴趣，则在N下面打勾。',
            selfAssessment: '请在下面两个表格中，对每个类别按照1（低）到7（高）的等级对自己的能力进行评分。'
        };

        // 添加全局变量来存储答案
        let userAnswers = {
            activities: {},
            abilities: {},
            careers: {},
            selfAssessment: {
                table1: {},
                table2: {}
            }
        };

        // 添加自我评估数据
        const selfAssessmentData = {
            table1: {
                R: "机械操作能力(R)",
                I: "科学研究能力(I)",
                A: "艺术创作能力(A)",
                S: "教授讲解能力(S)",
                E: "商业推销能力(E)",
                C: "事务管理能力(C)"
            },
            table2: {
                R: "动手能力(R)",
                I: "数学能力(I)",
                A: "音乐能力(A)",
                S: "理解他人能力(S)",
                E: "管理能力(E)",
                C: "行政能力(C)"
            }
        };

        function startTest() {
            // 重置用户答案
            userAnswers = {
                activities: {},
                abilities: {},
                careers: {},
                selfAssessment: {
                    table1: {},
                    table2: {}
                }
            };
            document.getElementById('instructions').style.display = 'none';
            document.getElementById('testForm').style.display = 'block';
            document.getElementById('testForm').className = 'animation-fade';
            document.getElementById('results').style.display = 'none';
            loadSection(0);
        }

        function loadSection(sectionIndex) {
            currentSection = sectionIndex;
            const section = sections[sectionIndex];
            const form = document.getElementById('testForm');
            form.innerHTML = '';
            
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section animation-fade';
            sectionDiv.innerHTML = `
                <h2>${sectionTitles[section]}</h2>
                <div style="text-align: right; margin-bottom: 10px; color: #666;">
                    <small>进度: ${sectionIndex + 1}/${sections.length}</small>
                </div>
                <p class="section-instruction">${sectionInstructions[section]}</p>
            `;

            if (section === 'selfAssessment') {
                // 创建自我评估表格
                const createAssessmentTable = (tableData, tableNumber) => {
                    const table = document.createElement('div');
                    table.className = 'assessment-table';
                    table.innerHTML = `
                        <h3>自我测评（${tableNumber}）</h3>
                        <div class="rating-scale">
                            <div>低能力 (1)</div>
                            <div>中等能力 (4)</div>
                            <div>高能力 (7)</div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>评分</th>
                                    ${Object.values(tableData).map(label => `
                                        <th>${label}</th>
                                    `).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${Array.from({length: 7}, (_, i) => `
                                    <tr>
                                        <td>${7 - i}</td>
                                        ${Object.keys(tableData).map(type => `
                                            <td>
                                                <input type="radio" 
                                                    name="assessment${tableNumber}_${type}" 
                                                    value="${7 - i}"
                                                    id="assessment${tableNumber}_${type}_${7-i}"
                                                    onchange="saveAssessmentAnswer(${tableNumber}, '${type}', ${7 - i})"
                                                >
                                            </td>
                                        `).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div class="rating-help">
                            <strong>评分指南：</strong>
                            <ul>
                                <li><strong>1-2分</strong>：表示在这方面能力较弱</li>
                                <li><strong>3-5分</strong>：表示在这方面能力中等</li>
                                <li><strong>6-7分</strong>：表示在这方面能力较强</li>
                            </ul>
                            <p>请在每一列（每个能力类别）中选择一个评分，对自己的能力进行客观评估。</p>
                        </div>
                    `;
                    return table;
                };

                sectionDiv.appendChild(createAssessmentTable(selfAssessmentData.table1, 1));
                sectionDiv.appendChild(createAssessmentTable(selfAssessmentData.table2, 2));
            } else {
                // 原有的问题加载逻辑
                Object.keys(testData[section]).forEach(type => {
                    const typeDiv = document.createElement('div');
                    typeDiv.className = 'type-section';
                    
                    // 添加类型标题
                    const typeTitle = document.createElement('div');
                    typeTitle.className = 'type-title';
                    typeTitle.textContent = `${type}类${section === 'activities' ? '活动' : section === 'abilities' ? '能力' : '职业'}`;
                    typeDiv.appendChild(typeTitle);
                    
                    // 创建问题表格
                    const table = document.createElement('table');
                    const thead = document.createElement('thead');
                    thead.innerHTML = `
                        <tr>
                            <th>${section === 'activities' ? '活动' : section === 'abilities' ? '能力' : '职业'}</th>
                            <th>选择</th>
                        </tr>
                    `;
                    table.appendChild(thead);
                    
                    const tbody = document.createElement('tbody');
                    testData[section][type].forEach((question, index) => {
                        const tr = document.createElement('tr');
                        const options = section === 'activities' ? 
                            [{value: 'L', label: 'L'}, {value: 'D', label: 'D'}] :
                            [{value: 'Y', label: 'Y'}, {value: 'N', label: 'N'}];
                        
                        // 获取已保存的答案
                        const savedAnswer = userAnswers[section]?.[type]?.[index];
                        
                        tr.innerHTML = `
                            <td>${question}</td>
                            <td class="option-group">
                                ${options.map(option => `
                                    <label>
                                        <input type="radio" 
                                            name="${type}_${index}" 
                                            value="${option.value}" 
                                            required
                                            ${savedAnswer === option.value ? 'checked' : ''}
                                            onchange="saveAnswer('${section}', '${type}', ${index}, '${option.value}')"
                                        > ${option.label}
                                    </label>
                                `).join('')}
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                    table.appendChild(tbody);
                    typeDiv.appendChild(table);
                    sectionDiv.appendChild(typeDiv);
                });
            }
            
            // 更新进度条
            const progress = ((sectionIndex + 1) / sections.length) * 100;
            document.querySelector('.progress').style.width = `${progress}%`;
            
            // 添加导航按钮
            const navButtons = document.createElement('div');
            navButtons.className = 'section-nav';
            navButtons.innerHTML = `
                ${sectionIndex > 0 ? '<button type="button" onclick="loadSection(' + (sectionIndex - 1) + ')">上一部分</button>' : ''}
                ${sectionIndex < sections.length - 1 ? 
                    '<button type="button" onclick="validateAndNext(' + sectionIndex + ')">下一部分</button>' : 
                    '<button type="button" onclick="validateAndShowResults()">查看结果</button>'}
            `;
            
            // 如果是最后一个部分，添加备用的查看结果按钮
            if (sectionIndex === sections.length - 1) {
                const backupButton = document.createElement('button');
                backupButton.type = 'button';
                backupButton.textContent = '备用-查看结果';
                backupButton.style.backgroundColor = '#FF9800';
                backupButton.style.marginLeft = '10px';
                backupButton.onclick = function() {
                    console.log("备用按钮被点击");
                    try {
                        // 直接显示结果，跳过常规的验证流程
                        showResults();
                        
                        // 确保结果页面显示
                        document.getElementById('instructions').style.display = 'none';
                        document.getElementById('testForm').style.display = 'none';
                        document.getElementById('results').style.display = 'block';
                        
                        // 滚动到结果部分
                        document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                    } catch (error) {
                        console.error("备用按钮出错:", error);
                        alert("显示结果时出现错误: " + error.message);
                    }
                };
                navButtons.appendChild(backupButton);
            }
            
            sectionDiv.appendChild(navButtons);
            form.appendChild(sectionDiv);
        }

        function saveAnswer(section, type, index, value) {
            if (!userAnswers[section]) {
                userAnswers[section] = {};
            }
            if (!userAnswers[section][type]) {
                userAnswers[section][type] = {};
            }
            userAnswers[section][type][index] = value;
        }

        function saveAssessmentAnswer(tableNumber, type, value) {
            if (!userAnswers.selfAssessment) {
                userAnswers.selfAssessment = {
                    table1: {},
                    table2: {}
                };
            }
            if (tableNumber === 1) {
                userAnswers.selfAssessment.table1[type] = value;
            } else {
                userAnswers.selfAssessment.table2[type] = value;
            }
        }

        function validateAndNext(currentIndex) {
            // 保存当前部分的答案
            const section = sections[currentIndex];
            Object.keys(testData[section]).forEach(type => {
                testData[section][type].forEach((_, index) => {
                    const radios = document.getElementsByName(`${type}_${index}`);
                    for (const radio of radios) {
                        if (radio.checked) {
                            saveAnswer(section, type, index, radio.value);
                        }
                    }
                });
            });
            
            // 直接进入下一部分
            loadSection(currentIndex + 1);
        }

        function validateAndShowResults() {
            console.log("validateAndShowResults被调用");
            // 保存当前部分的答案
            const section = sections[currentSection];
            console.log("当前部分:", section);
            
            try {
                if (section === 'selfAssessment') {
                    console.log("保存自我评估答案", userAnswers.selfAssessment);
                    // 检查是否所有自我评估问题都已回答
                    let allAnswered = true;
                    const missingAnswers = [];
                    
                    // 检查表1
                    Object.keys(selfAssessmentData.table1).forEach(type => {
                        if (!userAnswers.selfAssessment.table1[type]) {
                            allAnswered = false;
                            missingAnswers.push(`表1的${selfAssessmentData.table1[type]}`);
                        }
                    });
                    
                    // 检查表2
                    Object.keys(selfAssessmentData.table2).forEach(type => {
                        if (!userAnswers.selfAssessment.table2[type]) {
                            allAnswered = false;
                            missingAnswers.push(`表2的${selfAssessmentData.table2[type]}`);
                        }
                    });
                    
                    if (!allAnswered) {
                        const warnMessage = `您有以下自我评估项目尚未评分：\n${missingAnswers.join('\n')}\n\n是否仍要继续查看结果？`;
                        if (!confirm(warnMessage)) {
                            return; // 用户选择不继续
                        }
                    }
                } else {
                    Object.keys(testData[section]).forEach(type => {
                        testData[section][type].forEach((_, index) => {
                            const radios = document.getElementsByName(`${type}_${index}`);
                            for (const radio of radios) {
                                if (radio.checked) {
                                    saveAnswer(section, type, index, radio.value);
                                }
                            }
                        });
                    });
                }
                
                // 显示加载指示器
                const loadingIndicator = document.createElement('div');
                loadingIndicator.style.textAlign = 'center';
                loadingIndicator.style.padding = '50px';
                loadingIndicator.innerHTML = `
                    <div style="display: inline-block; width: 50px; height: 50px; border: 5px solid #f3f3f3; 
                         border-top: 5px solid #4CAF50; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <p>正在分析您的测试结果...</p>
                `;
                document.getElementById('testForm').style.display = 'none';
                document.getElementById('results').style.display = 'block';
                document.getElementById('resultContent').innerHTML = '';
                document.getElementById('resultContent').appendChild(loadingIndicator);
                
                // 使用setTimeout让UI更新后再计算结果
                setTimeout(() => {
                    // 直接显示结果
                    console.log("显示结果中...");
                    showResults();
                    
                    // 确保结果页面显示
                    console.log("设置结果页面显示");
                    document.getElementById('instructions').style.display = 'none';
                    document.getElementById('testForm').style.display = 'none';
                    document.getElementById('results').style.display = 'block';
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                    document.getElementById('results').className = 'animation-fade';
                    console.log("结果页面应该已显示");
                }, 800); // 延迟800毫秒再显示结果，模拟计算过程
            } catch (error) {
                console.error("validateAndShowResults出错:", error);
                alert("显示结果时出现错误: " + error.message);
            }
        }

        function calculateTotalScores() {
            console.log("开始计算总分");
            const scores = {
                R: 0, I: 0, A: 0, S: 0, E: 0, C: 0
            };
            
            // 创建详细分数对象，记录每个部分的得分
            const detailedScores = {
                R: { activities: 0, abilities: 0, careers: 0, selfAssessment1: 0, selfAssessment2: 0, total: 0 },
                I: { activities: 0, abilities: 0, careers: 0, selfAssessment1: 0, selfAssessment2: 0, total: 0 },
                A: { activities: 0, abilities: 0, careers: 0, selfAssessment1: 0, selfAssessment2: 0, total: 0 },
                S: { activities: 0, abilities: 0, careers: 0, selfAssessment1: 0, selfAssessment2: 0, total: 0 },
                E: { activities: 0, abilities: 0, careers: 0, selfAssessment1: 0, selfAssessment2: 0, total: 0 },
                C: { activities: 0, abilities: 0, careers: 0, selfAssessment1: 0, selfAssessment2: 0, total: 0 }
            };
            
            try {
                // 计算活动、能力和职业部分的分数
                Object.keys(detailedScores).forEach(type => {
                    console.log(`计算${type}类型的分数`);
                    
                    // 计算第一部分：活动
                    let activitiesCount = 0;
                    if (userAnswers.activities && userAnswers.activities[type]) {
                        Object.values(userAnswers.activities[type]).forEach(answer => {
                            if (answer === 'L') {
                                detailedScores[type].activities++;
                                activitiesCount++;
                            }
                        });
                    }
                    console.log(`${type}类型活动部分得分: ${detailedScores[type].activities}/${testData.activities[type].length}`);
                    
                    // 计算第二部分：能力
                    let abilitiesCount = 0;
                    if (userAnswers.abilities && userAnswers.abilities[type]) {
                        Object.values(userAnswers.abilities[type]).forEach(answer => {
                            if (answer === 'Y') {
                                detailedScores[type].abilities++;
                                abilitiesCount++;
                            }
                        });
                    }
                    console.log(`${type}类型能力部分得分: ${detailedScores[type].abilities}/${testData.abilities[type].length}`);
                    
                    // 计算第三部分：职业
                    let careersCount = 0;
                    if (userAnswers.careers && userAnswers.careers[type]) {
                        Object.values(userAnswers.careers[type]).forEach(answer => {
                            if (answer === 'Y') {
                                detailedScores[type].careers++;
                                careersCount++;
                            }
                        });
                    }
                    console.log(`${type}类型职业部分得分: ${detailedScores[type].careers}/${testData.careers[type].length}`);
                    
                    // 计算自我评估部分
                    if (userAnswers.selfAssessment) {
                        // 自我评估表1
                        const table1Score = parseInt(userAnswers.selfAssessment.table1[type] || 0);
                        if (!isNaN(table1Score)) {
                            // 将1-7的评分调整到合适的范围
                            detailedScores[type].selfAssessment1 = table1Score;
                        }
                        
                        // 自我评估表2
                        const table2Score = parseInt(userAnswers.selfAssessment.table2[type] || 0);
                        if (!isNaN(table2Score)) {
                            // 将1-7的评分调整到合适的范围
                            detailedScores[type].selfAssessment2 = table2Score;
                        }
                        
                        console.log(`${type}类型自我评估得分: 表1=${detailedScores[type].selfAssessment1}, 表2=${detailedScores[type].selfAssessment2}`);
                    }
                    
                    // 计算总分 - 活动、能力和职业部分的得分相加，再加上自我评估部分
                    // 为保持分数平衡，将自我评估分数进行调整
                    
                    // 前三部分总分
                    const sectionsTotal = detailedScores[type].activities + detailedScores[type].abilities + detailedScores[type].careers;
                    
                    // 自我评估总分 - 将1-7的量表转换为合适的分数贡献
                    // 使用系数0.7来确保自我评估部分不会过度影响总分
                    const selfAssessmentTotal = (detailedScores[type].selfAssessment1 + detailedScores[type].selfAssessment2) * 0.7;
                    
                    // 最终总分 
                    detailedScores[type].total = sectionsTotal + selfAssessmentTotal;
                    
                    // 将总分存入scores对象
                    scores[type] = detailedScores[type].total;
                    
                    console.log(`${type}类型总分计算完成: 前三部分=${sectionsTotal}, 自我评估=${selfAssessmentTotal}, 总分=${scores[type]}`);
                });
                
                console.log('详细分数计算完成:', detailedScores);
                return {scores, detailedScores};
            } catch (error) {
                console.error('计算分数出错:', error);
                alert('计算分数时出现错误: ' + error.message);
                // 返回空分数以避免进一步错误
                return {scores, detailedScores};
            }
        }

        function showResults() {
            console.log("开始执行showResults函数");
            try {
                const {scores, detailedScores} = calculateTotalScores();
                console.log("计算得分完成:", scores);
                
                // 定义最大可能分数（用于计算百分比）
                const maxPossibleScore = 50; // 设定最大分数为50
                
                const percentages = {
                    R: 0, I: 0, A: 0, S: 0, E: 0, C: 0
                };
                
                // 将所有得分映射到0-50的范围
                Object.keys(scores).forEach(type => {
                    // 不再进行归一化计算，直接使用原始分数
                    // 但确保不超过50
                    percentages[type] = Math.min(scores[type], maxPossibleScore);
                });
                
                // 按百分比排序获取前三个最高分的类型
                const sortedTypes = Object.entries(percentages)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 3)
                    .map(([type]) => type);
                
                const hollandCode = sortedTypes.join('');
                console.log("生成Holland代码:", hollandCode);
                
                // 获取职业推荐
                const recommendedCareers = getHollandCodeCareers(hollandCode);
                
                console.log('User Answers:', userAnswers);
                console.log('Scores:', scores);
                console.log('Detailed Scores:', detailedScores);
                console.log('Percentages:', percentages);
                console.log('Holland Code:', hollandCode);
                
                // 生成结果报告
                console.log("开始生成结果报告");
                const resultContent = document.getElementById('resultContent');
                if (!resultContent) {
                    throw new Error("找不到resultContent元素");
                }
                const resultsDiv = document.getElementById('results');
                if (!resultsDiv) {
                    throw new Error("找不到results元素");
                }
                
                // 获取前三个类型的完整解释
                const topTypeDescriptions = sortedTypes.map((type, index) => {
                    return {
                        type: type,
                        name: getTypeName(type),
                        description: getTypeDescription(type),
                        score: percentages[type].toFixed(1),
                        rank: index + 1
                    };
                });
                
                resultContent.innerHTML = `
                    <div class="section">
                        <h3>您的RIASEC类型分析</h3>
                        <p>根据您的答案，我们为您生成了详细的职业倾向分析报告。以下是您在六种类型中的得分情况和相关的职业推荐。</p>
                        
                        <div class="chart-container">
                            <canvas id="riasecChart"></canvas>
                        </div>
                        
                        <h4>您的职业兴趣代码</h4>
                        <div class="holland-code">
                            <p>根据测试结果，您的Holland职业兴趣代码是：<strong>${hollandCode}</strong></p>
                            <p>这表示您的前三个主导类型依次是：</p>
                            <ul>
                                ${topTypeDescriptions.map(item => `
                                    <li>
                                        <strong>${item.name}</strong> (得分: ${item.score}) - ${item.description}
                                    </li>
                                `).join('')}
                            </ul>
                            <p style="margin-top: 15px;"><strong>类型解读：</strong>职业代码的组合顺序反映了您的主要兴趣和能力方向，第一个字母代表您最强的倾向，依次类推。不同组合指向不同的职业领域。</p>
                        </div>
                        
                        <h4>推荐职业</h4>
                        <div class="career-recommendations">
                            <p>基于您的职业兴趣代码 <strong>${hollandCode}</strong>，以下是最适合您的职业推荐：</p>
                            <ul>
                                ${recommendedCareers.map(career => `<li>${career}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <h4>得分统计</h4>
                        <table class="results-table">
                            <tr>
                                <th>类型</th>
                                <th>活动部分</th>
                                <th>能力部分</th>
                                <th>职业部分</th>
                                <th>自评(1)</th>
                                <th>自评(2)</th>
                                <th>总分</th>
                            </tr>
                            ${Object.entries(detailedScores).map(([type, detail]) => `
                                <tr class="${sortedTypes.includes(type) ? 'highlight-row' : ''}">
                                    <td>${getTypeName(type)}</td>
                                    <td>${detail.activities}</td>
                                    <td>${detail.abilities}</td>
                                    <td>${detail.careers}</td>
                                    <td>${detail.selfAssessment1}</td>
                                    <td>${detail.selfAssessment2}</td>
                                    <td><strong>${scores[type].toFixed(1)}</strong></td>
                                </tr>
                            `).join('')}
                        </table>
                        
                        <div class="section-nav">
                            <button onclick="loadSection(${sections.length - 1})">返回上一部分</button>
                            <button onclick="startTest()">重新开始测试</button>
                            <button onclick="saveResults()" style="background-color: #607d8b;">保存结果</button>
                        </div>
                    </div>
                `;
                
                // 创建折线图
                console.log("开始创建折线图");
                try {
                    const ctx = document.getElementById('riasecChart').getContext('2d');
                    if (!ctx) {
                        throw new Error("找不到riasecChart画布元素或其2D上下文");
                    }
                    
                    const chartData = Object.entries(percentages).map(([type, percentage]) => percentage);
                    const chartLabels = ['实际型(R)', '研究型(I)', '艺术型(A)', '社会型(S)', '企业型(E)', '常规型(C)'];
                    
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: chartLabels,
                            datasets: [{
                                label: '职业倾向得分',
                                data: chartData,
                                fill: false,
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgb(75, 192, 192)',
                                borderWidth: 3,
                                tension: 0.1,
                                pointBackgroundColor: 'rgb(75, 192, 192)',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: 'rgb(75, 192, 192)',
                                pointRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 50,
                                    ticks: {
                                        stepSize: 5,
                                        font: {
                                            size: 12
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: '得分',
                                        font: {
                                            size: 14,
                                            weight: 'bold'
                                        }
                                    }
                                },
                                x: {
                                    ticks: {
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'RIASEC职业倾向分析图',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    padding: {
                                        top: 10,
                                        bottom: 20
                                    }
                                },
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                    titleFont: {
                                        size: 14
                                    },
                                    bodyFont: {
                                        size: 14
                                    },
                                    padding: 10,
                                    displayColors: false,
                                    callbacks: {
                                        label: function(context) {
                                            return `得分: ${context.raw.toFixed(1)}`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log("创建折线图成功");
                } catch (chartError) {
                    console.error("创建折线图失败:", chartError);
                    // 创建简单的文字提示替代图表
                    const chartContainer = document.querySelector('.chart-container');
                    if (chartContainer) {
                        chartContainer.innerHTML = `
                            <div style="text-align: center; padding: 20px; color: red;">
                                图表加载失败，但您仍可以查看以下数据分析结果。<br>
                                错误信息: ${chartError.message}
                            </div>
                            <table class="results-table">
                                <tr>
                                    <th>类型</th>
                                    <th>得分</th>
                                </tr>
                                ${Object.entries(percentages).map(([type, score]) => `
                                    <tr>
                                        <td>${getTypeName(type)}</td>
                                        <td>${score.toFixed(1)}</td>
                                    </tr>
                                `).join('')}
                            </table>
                        `;
                    }
                }
                
                // 最后显示结果页面
                console.log("设置结果页面为显示");
                resultsDiv.style.display = 'block';
                
            } catch (error) {
                console.error('Error in showResults:', error);
                alert('生成结果时出现错误，请重试：' + error.message);
            }
        }

        // 添加保存结果功能
        function saveResults() {
            try {
                // 获取当前日期时间作为文件名的一部分
                const now = new Date();
                const dateString = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}`;
                const timeString = `${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}`;
                const filename = `职业测试结果_${dateString}_${timeString}`;
                
                // 创建一个选择对话框，让用户选择保存方式
                const saveOptions = document.createElement('div');
                saveOptions.className = 'save-dialog';
                saveOptions.innerHTML = `
                    <div class="save-dialog-content">
                        <h3>保存结果</h3>
                        <p>请选择保存方式：</p>
                        <div class="save-options">
                            <button id="save-as-image">保存为图片</button>
                            <button id="save-as-html">保存为HTML文件</button>
                        </div>
                        <button id="close-save-dialog" class="close-button">取消</button>
                    </div>
                `;
                document.body.appendChild(saveOptions);
                
                // 添加事件监听器
                document.getElementById('save-as-image').addEventListener('click', function() {
                    saveAsImage(filename);
                });
                
                document.getElementById('save-as-html').addEventListener('click', function() {
                    saveAsHTML(filename);
                });
                
                document.getElementById('close-save-dialog').addEventListener('click', function() {
                    closeSaveDialog();
                });
            } catch (error) {
                alert('保存结果功能出错: ' + error.message);
            }
        }
        
        // 保存为图片
        function saveAsImage(filename) {
            try {
                // 获取结果容器
                const resultSection = document.querySelector('#resultContent .section');
                if (!resultSection) {
                    throw new Error('未找到结果内容');
                }
                
                // 显示加载消息
                const loadingMsg = document.createElement('div');
                loadingMsg.style.position = 'fixed';
                loadingMsg.style.top = '50%';
                loadingMsg.style.left = '50%';
                loadingMsg.style.transform = 'translate(-50%, -50%)';
                loadingMsg.style.padding = '20px';
                loadingMsg.style.background = 'rgba(0,0,0,0.7)';
                loadingMsg.style.color = 'white';
                loadingMsg.style.borderRadius = '8px';
                loadingMsg.style.zIndex = '2000';
                loadingMsg.innerHTML = '正在生成图片，请稍候...';
                document.body.appendChild(loadingMsg);
                
                // 使用html2canvas将结果转换为图片
                html2canvas(resultSection, {
                    scale: 2, // 提高图像质量
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff'
                }).then(function(canvas) {
                    try {
                        // 转换为图片并下载
                        const imgData = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.download = `${filename}.png`;
                        link.href = imgData;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        // 移除加载消息
                        document.body.removeChild(loadingMsg);
                        
                        // 关闭对话框
                        closeSaveDialog();
                    } catch (err) {
                        document.body.removeChild(loadingMsg);
                        alert('生成图片失败: ' + err.message);
                        closeSaveDialog();
                    }
                }).catch(function(err) {
                    document.body.removeChild(loadingMsg);
                    alert('生成图片时出错: ' + err.message);
                    closeSaveDialog();
                });
            } catch (error) {
                alert('保存图片失败: ' + error.message);
                closeSaveDialog();
            }
        }
        
        // 保存为HTML
        function saveAsHTML(filename) {
            try {
                // 获取结果内容
                const resultSection = document.querySelector('#resultContent .section');
                if (!resultSection) {
                    throw new Error('未找到结果内容');
                }
                
                // 创建一个完整的HTML文档
                const htmlContent = `
                <!DOCTYPE html>
                <html lang="zh">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>职业倾向测试结果</title>
                    <style>
                        body {
                            font-family: "Microsoft YaHei", sans-serif;
                            line-height: 1.6;
                            margin: 0;
                            padding: 20px;
                            background-color: #f5f5f5;
                        }
                        .container {
                            max-width: 800px;
                            margin: 0 auto;
                            background-color: white;
                            padding: 30px;
                            border-radius: 8px;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        }
                        h1, h2, h3, h4 {
                            color: #2c3e50;
                        }
                        h1 {
                            text-align: center;
                            margin-bottom: 30px;
                        }
                        h4 {
                            border-left: 4px solid #4CAF50;
                            padding-left: 10px;
                            margin-top: 20px;
                        }
                        .section {
                            margin-bottom: 30px;
                            padding: 20px;
                            background-color: #fff;
                            border-radius: 5px;
                        }
                        .highlight-row {
                            background-color: #e9f7ef !important;
                            font-weight: bold;
                        }
                        .holland-code {
                            background-color: #f8f9fa;
                            padding: 15px;
                            border-radius: 8px;
                            margin: 20px 0;
                            border-left: 4px solid #4CAF50;
                        }
                        .holland-code strong {
                            color: #4CAF50;
                            font-size: 1.2em;
                        }
                        .career-recommendations {
                            background-color: #f8f9fa;
                            padding: 15px;
                            border-radius: 8px;
                            margin: 20px 0;
                        }
                        .results-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 20px 0;
                        }
                        .results-table th {
                            background-color: #4CAF50;
                            color: white;
                            padding: 12px;
                            text-align: center;
                            border: 1px solid #ddd;
                        }
                        .results-table td {
                            padding: 10px;
                            text-align: center;
                            border: 1px solid #ddd;
                        }
                        .results-table tr:nth-child(even) {
                            background-color: #f2f2f2;
                        }
                        .results-table td:last-child {
                            font-weight: bold;
                            background-color: #e9f7ef;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 30px;
                            color: #666;
                            font-size: 14px;
                        }
                        .chart-container {
                            margin: 20px 0;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>职业倾向测试结果</h1>
                        ${resultSection.outerHTML}
                        <div class="footer">
                            <p>测试时间: ${new Date().toLocaleString()}</p>
                            <p>基于Holland职业兴趣理论 (RIASEC)</p>
                        </div>
                    </div>
                </body>
                </html>
                `;
                
                // 创建Blob和下载链接
                const blob = new Blob([htmlContent], {type: 'text/html'});
                const link = document.createElement('a');
                link.download = `${filename}.html`;
                link.href = URL.createObjectURL(blob);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // 关闭对话框
                closeSaveDialog();
            } catch (error) {
                alert('保存HTML失败: ' + error.message);
                closeSaveDialog();
            }
        }
        
        // 关闭保存对话框
        function closeSaveDialog() {
            const dialog = document.querySelector('.save-dialog');
            if (dialog) {
                document.body.removeChild(dialog);
            }
        }

        // 添加获取Holland代码对应职业的函数
        function getHollandCodeCareers(code) {
            const hollandCodeCareers = {
                'RIA': [
                    "工程师",
                    "科研技术人员",
                    "实验室技术员",
                    "质量控制专家",
                    "机械设计师",
                    "电子工程师",
                    "软件开发工程师"
                ],
                'RIE': [
                    "技术主管",
                    "项目经理",
                    "生产经理",
                    "技术总监",
                    "研发主管",
                    "工程部门经理",
                    "质量管理经理"
                ],
                'RIS': [
                    "职业技术教师",
                    "技术培训师",
                    "安全工程师",
                    "农业技术指导员",
                    "环保技术人员",
                    "医疗器械技术员"
                ],
                'ASE': [
                    "创意总监",
                    "艺术总监",
                    "广告设计师",
                    "多媒体制作人",
                    "时装设计师",
                    "室内设计师",
                    "建筑师"
                ],
                'AIS': [
                    "科技记者",
                    "科普作家",
                    "医学插画师",
                    "技术文档作者",
                    "建筑设计师",
                    "工业设计师"
                ],
                'SEC': [
                    "人力资源经理",
                    "培训经理",
                    "职业顾问",
                    "教育行政人员",
                    "社会工作者",
                    "健康教育工作者"
                ],
                'SIA': [
                    "心理咨询师",
                    "特殊教育教师",
                    "职业治疗师",
                    "语言治疗师",
                    "艺术治疗师",
                    "康复治疗师"
                ],
                'EIS': [
                    "管理咨询顾问",
                    "市场研究分析师",
                    "商业策略师",
                    "组织发展顾问",
                    "人才发展经理",
                    "企业培训师"
                ],
                'ECS': [
                    "金融经理",
                    "银行经理",
                    "保险经纪人",
                    "投资顾问",
                    "理财规划师",
                    "企业管理顾问"
                ],
                'CRE': [
                    "财务总监",
                    "审计经理",
                    "税务顾问",
                    "成本会计师",
                    "预算分析师",
                    "系统分析师"
                ]
            };

            // 如果没有完全匹配的代码，尝试匹配前两个字母
            const code2 = code.substring(0, 2);
            let careers = hollandCodeCareers[code] || [];
            
            if (careers.length === 0) {
                // 查找所有以这两个字母开头的代码的职业
                Object.keys(hollandCodeCareers).forEach(key => {
                    if (key.startsWith(code2)) {
                        careers = careers.concat(hollandCodeCareers[key]);
                    }
                });
            }
            
            // 如果还是没有找到，返回第一个字母对应类型的所有职业
            if (careers.length === 0) {
                const firstType = code[0];
                careers = testData.careers[firstType].slice(0, 7);
            }
            
            // 去重并限制返回数量
            return [...new Set(careers)].slice(0, 7);
        }

        function getTypeName(type) {
            const typeNames = {
                R: '实际型 (Realistic)',
                I: '研究型 (Investigative)',
                A: '艺术型 (Artistic)',
                S: '社会型 (Social)',
                E: '企业型 (Enterprising)',
                C: '常规型 (Conventional)'
            };
            return typeNames[type];
        }

        function getTypeDescription(type) {
            const descriptions = {
                R: '喜欢动手操作、制作、修理物品，擅长使用工具和机械，注重实际和具体的工作。',
                I: '喜欢研究和分析问题，擅长科学研究和逻辑思维，注重探索和发现。',
                A: '具有艺术天赋和创造力，喜欢表达自我，追求独特和创新。',
                S: '热心助人，善于与人交往，关注他人的需求和感受。',
                E: '具有领导才能，善于说服他人，追求成功和影响力。',
                C: '做事细心有条理，善于处理数据和文书工作，注重规范和秩序。'
            };
            return descriptions[type];
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化代码
            
            // 测试按钮代码已移除
        });
    </script>
</body>
</html> 